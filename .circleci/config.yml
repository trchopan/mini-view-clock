version: 2.1

workflows:
  build-and-deploy:
    jobs:
      - build-server:
          filters:
            branches:
              only:
                - /server\/.*/
                - /web\/.*/

jobs:
  build-server:
    machine: true
    resource_class: trchopan/raspberypi4
    steps:
      - run:
          name: Clone the git repository
          command: git clone $CIRCLE_REPOSITORY_URL -b $CIRCLE_BRANCH .
      - run:
          name: Build
          command: cargo build --release
      - run:
          name: Stop and install new binary
          command: sudo systemctl stop mini-hooks.service
